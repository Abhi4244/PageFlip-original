var StPageFlip=function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";var s,n,h,o,r,a;i.r(e),i.d(e,"SizeType",(function(){return a})),i.d(e,"App",(function(){return x})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right"}(s||(s={}));class g extends class{constructor(t){this.state={angle:0,area:[],corners:null,position:{x:0,y:0}},this.render=t}setPosition(t){this.state.position=t}setAngle(t){this.state.angle=t}setArea(t){this.state.area=t}setCorners(t){this.state.corners=t}}{constructor(t,e){super(t),this.image=null,this.isLoad=!1,this.loadingAngle=0,this.href=e}draw(){const t=this.render.getContext(),e=this.render.convertToGlobal(this.state.position),i=this.render.getRect().pageWidth,s=this.render.getRect().height;t.save(),t.translate(e.x,e.y),t.beginPath();for(let i of this.state.area)null!==i&&(i=this.render.convertToGlobal(i),t.lineTo(i.x-e.x,i.y-e.y));if(t.rotate(this.state.angle),t.clip(),this.isLoad)t.drawImage(this.image,0,0,i,s);else{t.beginPath(),t.strokeStyle="rgb(200, 200, 200)",t.fillStyle="rgb(255, 255, 255)",t.lineWidth=1,t.rect(1,1,i-1,s-1),t.stroke(),t.fill();const e={x:i/2,y:s/2};t.beginPath(),t.lineWidth=10,t.arc(e.x,e.y,20,this.loadingAngle,3*Math.PI/2+this.loadingAngle),t.stroke(),t.closePath(),this.loadingAngle+=.07,this.loadingAngle>=2*Math.PI&&(this.loadingAngle=0)}t.restore()}simpleDraw(t){const e=this.render.getRect(),i=this.render.getContext(),n=e.pageWidth,h=e.height,o=t===s.Right?e.left+e.pageWidth:e.left,r=e.top;if(this.isLoad)i.drawImage(this.image,o,r,n,h);else{i.beginPath(),i.strokeStyle="rgb(200, 200, 200)",i.fillStyle="rgb(255, 255, 255)",i.lineWidth=1,i.rect(o+1,r+1,n-1,h-1),i.stroke(),i.fill();const t={x:o+n/2,y:r+h/2};i.beginPath(),i.lineWidth=10,i.arc(t.x,t.y,20,this.loadingAngle,3*Math.PI/2+this.loadingAngle),i.stroke(),i.closePath(),this.loadingAngle+=.07,this.loadingAngle>=2*Math.PI&&(this.loadingAngle=0)}}async load(){return null==this.image&&(this.image=new Image,this.image.src=this.href),this.isLoad?Promise.resolve(this):new Promise(t=>{this.image.onload=()=>{this.isLoad=!0,t(this)}})}}class c{static GetDestinationFromTwoPoint(t,e){return null===t||null===e?1/0:Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static GetLineLenght(t){return c.GetDestinationFromTwoPoint(t[0],t[1])}static GetAngleFromTwoLine(t,e){const i=t[0].y-t[1].y,s=e[0].y-e[1].y,n=t[1].x-t[0].x,h=e[1].x-e[0].x;return Math.acos((i*s+n*h)/(Math.sqrt(i*i+n*n)*Math.sqrt(s*s+h*h)))}static PointInRect(t,e){return null===e?null:e.x>=t.left&&e.x<=t.width+t.left&&e.y>=t.top&&e.y<=t.top+t.height?e:null}static GetIntersectByLineAndCircle(t,e,i){if(c.GetDestinationFromTwoPoint(t,i)<=e)return i;const s=t.x,n=t.y,h=i.x,o=i.y;let r=Math.sqrt(Math.pow(e,2)*Math.pow(s-h,2)/(Math.pow(s-h,2)+Math.pow(n-o,2)))+s;i.x<0&&(r*=-1);let a=(r-s)*(n-o)/(s-h)+n;return s-h+n===0&&(a=e),{x:r,y:a}}static GetIntersectByTwoSegment(t,e,i){return c.PointInRect(t,c.GetIntersectByTwoLine(e,i))}static GetIntersectByTwoLine(t,e){const i=t[0].y-t[1].y,s=e[0].y-e[1].y,n=t[1].x-t[0].x,h=e[1].x-e[0].x,o=t[0].x*t[1].y-t[1].x*t[0].y,r=e[0].x*e[1].y-e[1].x*e[0].y,a=i*r-s*o,g=n*r-h*o,c=-(o*h-r*n)/(i*h-s*n),l=-(i*r-s*o)/(i*h-s*n);if(isFinite(c)&&isFinite(l))return{x:c,y:l};if(Math.abs(a-g)<.1)throw new Error("Segment included");return null}static GetCordsFromTwoPoint(t,e){const i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y),n=Math.max(i,s),h=[t];function o(t,e,i,s,n){return e>t?t+n*(i/s):e<t?t-n*(i/s):t}for(let r=1;r<=n;r++)h.push({x:o(t.x,e.x,i,n,r),y:o(t.y,e.y,s,n,r)});return h}}class l{constructor(t,e,i,s){this.direction=t,this.corner=e,this.pageWidth=i,this.pageHeight=s,this.topIntersectPoint=null,this.sideIntersectPoint=null,this.bottomIntersectPoint=null}calc(t){try{this.position=this.preparePosition(t),this.calculateIntersectPoint(this.position)}catch(t){console.log(t)}}getPageRect(t){return this.corner===h.TOP?this.getRectFromBasePoint([{x:0,y:0},{x:this.pageWidth,y:0},{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}],t):this.getRectFromBasePoint([{x:0,y:-this.pageHeight},{x:this.pageWidth,y:-this.pageHeight},{x:0,y:0},{x:this.pageWidth,y:0}],t)}getRectFromBasePoint(t,e){return{topLeft:this.getRotatedPoint(t[0],e),topRight:this.getRotatedPoint(t[1],e),bottomLeft:this.getRotatedPoint(t[2],e),bottomRight:this.getRotatedPoint(t[3],e)}}getRotatedPoint(t,e){return{x:t.x*Math.cos(this.angle)+t.y*Math.sin(this.angle)+e.x,y:t.y*Math.cos(this.angle)-t.x*Math.sin(this.angle)+e.y}}updateAngleAndGeometry(t){this.angle=this.calculateAngle(t),this.rect=this.getPageRect(t)}calculateIntersectPoint(t){const e={left:-1,top:-1,width:this.pageWidth+2,height:this.pageHeight+2};this.corner===h.TOP?(this.topIntersectPoint=c.GetIntersectByTwoSegment(e,[t,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=c.GetIntersectByTwoSegment(e,[t,this.rect.bottomLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=c.GetIntersectByTwoSegment(e,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}])):(this.topIntersectPoint=c.GetIntersectByTwoSegment(e,[this.rect.topLeft,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=c.GetIntersectByTwoSegment(e,[t,this.rect.topLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=c.GetIntersectByTwoSegment(e,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}]))}checkPositionAtCenterLine(t,e,i){let s=t;const n=c.GetIntersectByLineAndCircle(e,this.pageWidth,s);s!==n&&(s=n,this.updateAngleAndGeometry(s));const o=Math.sqrt(Math.pow(this.pageWidth,2)+Math.pow(this.pageHeight,2));let r=this.rect.bottomRight,a=this.rect.topLeft;if(this.corner===h.BOTTOM&&(r=this.rect.topRight,a=this.rect.bottomLeft),r.x<=0){const t=c.GetIntersectByLineAndCircle(i,o,a);t!==s&&(s=t,this.updateAngleAndGeometry(s))}return s}preparePosition(t){let e=t;if(this.updateAngleAndGeometry(e),e=this.corner===h.TOP?this.checkPositionAtCenterLine(e,{x:0,y:0},{x:0,y:this.pageHeight}):this.checkPositionAtCenterLine(e,{x:0,y:this.pageHeight},{x:0,y:0}),Math.abs(e.x-this.pageWidth)<1&&Math.abs(e.y)<1)throw new Error("Point is too small");return e}calculateAngle(t){const e=this.pageWidth-t.x,i=this.corner===h.BOTTOM?this.pageHeight-t.y:t.y;let s=2*Math.acos(e/Math.sqrt(i*i+e*e));i<0&&(s=-s);const n=Math.PI-s;if(!isFinite(s)||n>=0&&n<.003)throw new Error("The G point is too small");return this.corner===h.BOTTOM&&(s=-s),s}getAngle(){return this.direction===n.FORWARD?-this.angle:this.angle}getRect(){return this.rect}getPosition(){return this.position}getActiveCorner(){return this.direction===n.FORWARD?this.rect.topLeft:this.rect.topRight}getDirection(){return this.direction}getIntersectPoint(){return{top:this.topIntersectPoint,bottom:this.bottomIntersectPoint,side:this.sideIntersectPoint}}getSegmentToShadowLine(){const t=this.getShadowStartPoint();return[t,t!==this.sideIntersectPoint&&null!==this.sideIntersectPoint?this.sideIntersectPoint:this.bottomIntersectPoint]}getShadowStartPoint(){return this.corner===h.TOP?this.topIntersectPoint:null!==this.sideIntersectPoint?this.sideIntersectPoint:this.topIntersectPoint}getShadowAngle(){const t=c.GetAngleFromTwoLine(this.getSegmentToShadowLine(),[{x:0,y:0},{x:this.pageWidth,y:0}]);return this.direction===n.FORWARD?t:Math.PI-t}getFlippingProgress(){return Math.abs((this.position.x-this.pageWidth)/(2*this.pageWidth)*100)}getFlippingClipArea(){const t=[];let e=!1;return t.push(this.rect.topLeft),t.push(this.topIntersectPoint),null===this.sideIntersectPoint?e=!0:(t.push(this.sideIntersectPoint),null===this.bottomIntersectPoint&&(e=!1)),t.push(this.bottomIntersectPoint),(e||this.corner===h.BOTTOM)&&t.push(this.rect.bottomLeft),t}getCorner(){return this.corner}getBottomClipArea(){const t=[];return t.push(this.topIntersectPoint),this.corner===h.TOP?t.push({x:this.pageWidth,y:0}):(null!==this.topIntersectPoint&&t.push({x:this.pageWidth,y:0}),t.push({x:this.pageWidth,y:this.pageHeight})),null!==this.sideIntersectPoint?c.GetDestinationFromTwoPoint(this.sideIntersectPoint,this.topIntersectPoint)>=10&&t.push(this.sideIntersectPoint):this.corner===h.TOP&&t.push({x:this.pageWidth,y:this.pageHeight}),t.push(this.bottomIntersectPoint),t.push(this.topIntersectPoint),t}getBottomPagePosition(){return this.direction===n.BACK?{x:this.pageWidth,y:0}:{x:0,y:0}}}!function(t){t[t.FORWARD=0]="FORWARD",t[t.BACK=1]="BACK"}(n||(n={})),function(t){t[t.TOP=0]="TOP",t[t.BOTTOM=1]="BOTTOM"}(h||(h={})),function(t){t.USER_FOLD="user_fold",t.FOLD_CORNER="fold_corner",t.FLIPPING="flipping",t.READ="read"}(o||(o={}));class p{constructor(t,e){this.flippingPage=null,this.bottomPage=null,this.calc=null,this.state=o.READ,this.render=t,this.app=e}getCalculation(){return this.calc}start(t){this.reset();const e=this.render.convertToBook(t),i=this.getBoundsRect();let s=n.FORWARD;this.render.getOrientation()===r.PORTRAIT?e.x-i.pageWidth<=i.width/5&&(s=n.BACK):e.x<i.width/2&&(s=n.BACK);const o=e.y>=i.height/2?h.BOTTOM:h.TOP;if(!this.checkDirection(s))return!1;try{return this.flippingPage=this.getFlippingPage(s),this.bottomPage=this.getBottomPage(s),this.flippingPage&&this.bottomPage?(this.render.setDirection(s),this.calc=new l(s,o,i.pageWidth,i.height),!0):!1}catch(t){return!1}}showCorner(t){if(!this.checkState(o.READ,o.FOLD_CORNER))return;const e=this.getBoundsRect(),i=e.pageWidth,s=Math.sqrt(Math.pow(i,2)+Math.pow(e.height,2))/5,n=this.render.convertToBook(t);if(n.x>0&&n.y>0&&n.x<e.width&&n.y<e.height&&(n.x<s||n.x>e.width-s)&&(n.y<s||n.y>e.height-s))if(null===this.calc){if(!this.start(t))return;this.setState(o.FOLD_CORNER),this.calc.calc({x:i-1,y:1});const s=50,n=this.calc.getCorner()===h.BOTTOM?e.height-1:1,r=this.calc.getCorner()===h.BOTTOM?e.height-s:s;this.animateFlippingTo({x:i-1,y:n},{x:i-s,y:r},!1,!1)}else this.do(this.render.convertToPage(t));else this.setState(o.READ),this.render.finishAnimation(),this.stopMove()}fold(t){this.setState(o.USER_FOLD),null===this.calc&&this.start(t),this.do(this.render.convertToPage(t))}flip(t){if(null!==this.calc&&this.render.finishAnimation(),!this.start(t))return;const e=this.getBoundsRect();this.setState(o.FLIPPING);const i=e.height/10,s=this.calc.getCorner()===h.BOTTOM?e.height-i:i,n=this.calc.getCorner()===h.BOTTOM?e.height:0;this.calc.calc({x:e.pageWidth-i,y:s}),this.animateFlippingTo({x:e.pageWidth-i,y:s},{x:-e.pageWidth,y:n},!0)}stopMove(){if(null===this.calc)return;const t=this.calc.getPosition(),e=this.getBoundsRect(),i=this.calc.getCorner()===h.BOTTOM?e.height:0;t.x<=0?this.animateFlippingTo(t,{x:-e.pageWidth,y:i},!0):this.animateFlippingTo(t,{x:e.pageWidth,y:i},!1)}do(t){null!==this.calc&&(this.calc.calc(t),this.flippingPage.setArea(this.calc.getFlippingClipArea()),this.flippingPage.setPosition(this.calc.getActiveCorner()),this.flippingPage.setAngle(this.calc.getAngle()),this.bottomPage.setArea(this.calc.getBottomClipArea()),this.bottomPage.setPosition(this.calc.getBottomPagePosition()),this.bottomPage.setAngle(0),this.render.setPageRect(this.calc.getRect()),this.render.setBottomPage(this.bottomPage),this.render.setFlippingPage(this.flippingPage),this.render.drawShadow(this.calc.getShadowStartPoint(),this.calc.getShadowAngle(),this.calc.getFlippingProgress(),this.calc.getDirection()))}animateFlippingTo(t,e,i,s=!0){const h=c.GetCordsFromTwoPoint(t,e),r=[];for(const t of h)r.push(()=>this.do(t));const a=this.getAnimationDuration(h.length);this.render.startAnimation(r,a,()=>{i&&(this.calc.getDirection()===n.BACK?this.app.turnToPrevPage():this.app.turnToNextPage()),s&&(this.render.setBottomPage(null),this.render.setFlippingPage(null),this.render.clearShadow(),this.state=o.READ,this.reset())})}getAnimationDuration(t){return t<200?400:t<500?470:1e3}getFlippingPage(t){const e=this.app.getCurrentPageIndex();return this.render.getOrientation()===r.PORTRAIT?t===n.FORWARD?this.app.getPage(e):this.app.getPage(e-1):e<this.app.getPageCount()-1&&e>=0?t===n.FORWARD?this.app.getPage(e+2):this.app.getPage(e-1):null}getNextPage(){const t=this.app.getCurrentPageIndex(),e=this.render.getOrientation()===r.PORTRAIT?0:2;return t<this.app.getPageCount()-e?this.app.getPage(t+e+1):null}getPrevPage(){const t=this.app.getCurrentPageIndex(),e=this.render.getOrientation()===r.PORTRAIT?0:2;return t-e>=0?this.app.getPage(t-e):null}getBottomPage(t){return t===n.FORWARD?this.getNextPage():this.getPrevPage()}checkDirection(t){return t===n.FORWARD?this.app.getCurrentPageIndex()<=this.app.getPageCount()-1:this.app.getCurrentPageIndex()>=1}reset(){this.calc=null,this.flippingPage=null,this.bottomPage=null}getBoundsRect(){return this.render.getRect()}getPageWidth(){return this.getBoundsRect().width/2}getPageHeight(){return this.getBoundsRect().height}setState(t){this.app.updateState(t),this.state=t}checkState(...t){for(const e of t)if(this.state===e)return!0;return!1}}!function(t){t[t.PORTRAIT=0]="PORTRAIT",t[t.LANDSCAPE=1]="LANDSCAPE"}(r||(r={}));class d extends class{constructor(t){this.pages=[],this.render=t}getPageCount(){return this.pages.length}getPages(){return this.pages}getPage(t){if(t>=0&&t<this.pages.length)return this.pages[t];throw new Error("Invalid page number")}show(t){t<0||t>=this.pages.length||(this.render.getOrientation()===r.PORTRAIT?(this.render.setLeftPage(null),this.render.setRightPage(this.pages[t])):(t===this.pages.length-1&&t--,this.render.setLeftPage(this.pages[t]),this.render.setRightPage(this.pages[t+1])))}}{constructor(t,e){super(t),this.imagesHref=e}async load(){const t=[];for(const e of this.imagesHref){const i=new g(this.render,e);t.push(i.load()),this.pages.push(i)}return Promise.all(t)}}class u extends class{constructor(t){this.leftPage=null,this.rightPage=null,this.flippingPage=null,this.bottomPage=null,this.shadow=null,this.pageRect=null,this.animation=null,this.timer=0,this.direction=null,this.orientation=null,this.setting=t}setPageRect(t){this.pageRect=this.convertRectToGlobal(t)}getOrientation(){return null===this.orientation&&(this.orientation=this.findOrientation()),this.orientation}startAnimation(t,e,i){this.finishAnimation(),this.animation={frames:t,duration:e,durationFrame:e/t.length,onAnimateEnd:i,startedAt:this.timer}}finishAnimation(){null!==this.animation&&(this.animation.frames[this.animation.frames.length-1](),null!==this.animation.onAnimateEnd&&this.animation.onAnimateEnd()),this.animation=null}render(t){if(null!==this.animation){const e=Math.round((t-this.animation.startedAt)/this.animation.durationFrame);e<this.animation.frames.length?this.animation.frames[e]():(this.animation.onAnimateEnd(),this.animation=null)}this.timer=t,this.drawFrame(t)}findOrientation(){return this.getBlockHeight()>this.getBlockWidth()?r.PORTRAIT:r.LANDSCAPE}getRect(){const t=this.findOrientation(),e=this.getBlockWidth()/2,i=this.getBlockHeight()/2,s=this.setting.width/this.setting.height;let n=this.setting.width,h=this.setting.height,o=e-n;return this.setting.size===a.STRETCH&&(n=t===r.LANDSCAPE?this.getBlockWidth()/2:this.getBlockWidth(),n>this.setting.maxWidth&&(n=this.setting.maxWidth),h=n/s,h>this.getBlockHeight()&&(h=this.getBlockHeight(),n=h*s),o=t===r.LANDSCAPE?e-n:e-n/2-n),this.orientation=t,{left:o,top:i-h/2,width:2*n,height:h,pageWidth:n}}convertToBook(t){const e=this.getRect();return{x:t.x-e.left,y:t.y-e.top}}convertToPage(t,e){e||(e=this.direction);const i=this.getRect();return{x:e===n.FORWARD?t.x-i.left-i.width/2:i.width/2-t.x+i.left,y:t.y-i.top}}convertToGlobal(t,e){if(e||(e=this.direction),null==t)return null;const i=this.getRect();return{x:e===n.FORWARD?t.x+i.left+i.width/2:i.width/2-t.x+i.left,y:t.y+i.top}}convertRectToGlobal(t,e){return e||(e=this.direction),{topLeft:this.convertToGlobal(t.topLeft,e),topRight:this.convertToGlobal(t.topRight,e),bottomLeft:this.convertToGlobal(t.bottomLeft,e),bottomRight:this.convertToGlobal(t.bottomRight,e)}}start(){const t=e=>{this.render(e),requestAnimationFrame(t)};requestAnimationFrame(t)}setDirection(t){this.direction=t}setLeftPage(t){this.leftPage=t}setFlippingPage(t){this.flippingPage=t}setBottomPage(t){this.bottomPage=t}setRightPage(t){this.rightPage=t}}{constructor(t,e){super(e),this.canvas=t,this.ctx=t.getContext("2d")}getBlockWidth(){return this.canvas.width}getBlockHeight(){return this.canvas.height}getContext(){return this.ctx}drawShadow(t,e,i,s){this.shadow={pos:t,angle:e,width:3*this.getRect().pageWidth/4*i/100,opacity:(100-i)/100,direction:s}}clearShadow(){this.shadow=null}drawFrame(t){this.clear(),this.orientation!==r.PORTRAIT&&null!=this.leftPage&&this.leftPage.simpleDraw(s.Left),null!=this.rightPage&&this.rightPage.simpleDraw(s.Right),null!=this.bottomPage&&this.bottomPage.draw(),this.drawBookShadow(),null!=this.flippingPage&&this.flippingPage.draw(),null!=this.shadow&&(this.drawOuterShadow(),this.drawInnerShadow());const e=this.getRect();this.orientation===r.PORTRAIT&&(this.ctx.beginPath(),this.ctx.rect(e.left+e.pageWidth,e.top,e.width,e.height),this.ctx.clip())}drawBookShadow(){const t=this.getRect();this.ctx.save(),this.ctx.beginPath();const e=t.width/20;this.ctx.rect(t.left,t.top,t.width,t.height);const i={x:t.left+t.width/2-e/2,y:0};this.ctx.translate(i.x,i.y);const s=this.ctx.createLinearGradient(0,0,e,0);s.addColorStop(0,"rgba(0, 0, 0, 0)"),s.addColorStop(.4,"rgba(0, 0, 0, 0.2)"),s.addColorStop(.49,"rgba(0, 0, 0, 0.1)"),s.addColorStop(.5,"rgba(0, 0, 0, 0.5)"),s.addColorStop(.51,"rgba(0, 0, 0, 0.4)"),s.addColorStop(1,"rgba(0, 0, 0, 0)"),this.ctx.clip(),this.ctx.fillStyle=s,this.ctx.fillRect(0,0,e,2*t.height),this.ctx.restore()}drawOuterShadow(){const t=this.getRect();this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(t.left,t.top,t.width,t.height);const e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y});this.ctx.translate(e.x,e.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const i=this.ctx.createLinearGradient(0,0,this.shadow.width,0);this.shadow.direction===n.FORWARD?(this.ctx.translate(0,-100),i.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),i.addColorStop(1,"rgba(0, 0, 0, 0)")):(this.ctx.translate(-this.shadow.width,-100),i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")")),this.ctx.clip(),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,this.shadow.width,2*t.height),this.ctx.restore()}drawInnerShadow(){const t=this.getRect();this.ctx.save(),this.ctx.beginPath();const e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y});this.ctx.moveTo(this.pageRect.topLeft.x,this.pageRect.topLeft.y),this.ctx.lineTo(this.pageRect.topRight.x,this.pageRect.topRight.y),this.ctx.lineTo(this.pageRect.bottomRight.x,this.pageRect.bottomRight.y),this.ctx.lineTo(this.pageRect.bottomLeft.x,this.pageRect.bottomLeft.y),this.ctx.translate(e.x,e.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const i=3*this.shadow.width/4,s=this.ctx.createLinearGradient(0,0,i,0);this.shadow.direction===n.FORWARD?(this.ctx.translate(-i,-100),s.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")"),s.addColorStop(.9,"rgba(0, 0, 0, 0.05)"),s.addColorStop(.7,"rgba(0, 0, 0, "+this.shadow.opacity+")"),s.addColorStop(0,"rgba(0, 0, 0, 0)")):(this.ctx.translate(0,-100),s.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),s.addColorStop(.1,"rgba(0, 0, 0, 0.05)"),s.addColorStop(.3,"rgba(0, 0, 0, "+this.shadow.opacity+")"),s.addColorStop(1,"rgba(0, 0, 0, 0)")),this.ctx.clip(),this.ctx.fillStyle=s,this.ctx.fillRect(0,0,i,2*t.height),this.ctx.restore()}clear(){this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}class P{constructor(t,e,i){t.classList.add("stf__wrapper"),t.setAttribute("style","min-width: "+2*i.minWidth+"px; min-height: "+i.minHeight+"px"),i.size===a.FIXED&&t.setAttribute("style","min-width: "+2*i.width+"px; min-height: "+i.height+"px"),t.innerHTML="<canvas></canvas>",this.canvas=t.querySelectorAll("canvas")[0],window.addEventListener("resize",()=>{this.resizeCanvas()},!1),this.resizeCanvas(),this.app=e,this.setHandlers()}resizeCanvas(){const t=getComputedStyle(this.canvas),e=parseInt(t.getPropertyValue("width"),10),i=parseInt(t.getPropertyValue("height"),10);this.canvas.width=e,this.canvas.height=i}setHandlers(){this.canvas.onmousedown=t=>{const e=this.getMousePos(t.clientX,t.clientY);this.app.startUserTouch(e)},this.canvas.ontouchstart=t=>{if(t.changedTouches.length>0){const e=t.changedTouches[0];this.app.startUserTouch(this.getMousePos(e.clientX,e.clientY))}return!1},window.onmousemove=t=>{const e=this.getMousePos(t.clientX,t.clientY);this.app.userMove(e)},window.ontouchmove=t=>{if(t.changedTouches.length>0){const e=t.changedTouches[0];this.app.userMove(this.getMousePos(e.clientX,e.clientY))}},window.onmouseup=t=>{const e=this.getMousePos(t.clientX,t.clientY);this.app.userStop(e)},window.ontouchend=t=>{if(t.changedTouches.length>0){const e=t.changedTouches[0];this.app.userStop(this.getMousePos(e.clientX,e.clientY))}}}getCanvas(){return this.canvas}getMousePos(t,e){const i=this.canvas.getBoundingClientRect();return{x:t-i.left,y:e-i.top}}}!function(t){t[t.FIXED=0]="FIXED",t[t.STRETCH=1]="STRETCH"}(a||(a={}));class x extends class{constructor(){this.events={}}on(t,e){return t in this.events?this.events[t].push(e):this.events[t]=[e],this}off(t){delete this.events[t]}trigger(t,e,i=null){t in this.events&&this.events[t].forEach(t=>{t({data:i,object:e})})}}{constructor(t,e){super(),this.isUserTouch=!1,this.isUserMove=!1,this.pages=null,this.currentPage=0,this.setting={width:600,height:800,size:a.STRETCH,minWidth:150,maxWidth:600,minHeight:300,maxHeight:2200,startPage:2};const i=new P(t,this,this.setting);this.canvas=i.getCanvas(),this.render=new u(this.canvas,this.setting),this.flip=new p(this.render,this),this.render.start()}turnToPrevPage(){const t=this.render.getOrientation()===r.PORTRAIT?1:2;this.currentPage<t||(this.currentPage-=t,this.pages.show(this.currentPage),this.trigger("flip",this,this.currentPage))}turnToNextPage(){const t=this.render.getOrientation()===r.PORTRAIT?1:2;this.currentPage>this.pages.getPageCount()-t||(this.currentPage+=t,this.pages.show(this.currentPage),this.trigger("flip",this,this.currentPage))}turnToPage(t){this.checkPage(t)&&(this.currentPage=t,this.pages.show(this.currentPage),this.trigger("flip",this,this.currentPage))}loadFromImages(t){this.pages=new d(this.render,t),this.pages.load(),this.pages.show(this.setting.startPage),this.currentPage=this.setting.startPage,this.trigger("flip",this,this.currentPage)}updateState(t){this.trigger("changeState",this,t)}getPageCount(){return this.pages.getPageCount()}getCurrentPageIndex(){return this.currentPage}getCurrentPage(){return this.pages.getPage(this.currentPage)}getPage(t){return this.pages.getPage(t)}startUserTouch(t){this.mousePosition=t,this.isUserTouch=!0,this.isUserMove=!1}userMove(t){this.isUserTouch?c.GetDestinationFromTwoPoint(this.mousePosition,t)>5&&(this.isUserMove=!0,this.flip.fold(t)):this.flip.showCorner(t)}userStop(t){this.isUserTouch&&(this.isUserTouch=!1,this.isUserMove?this.flip.stopMove():this.flip.flip(t))}checkPage(t){return t>=0&&t<this.pages.getPageCount()}}}]);